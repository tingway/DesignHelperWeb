<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DesignHelper Web - é€šå ±å–®ç”¢ç”Ÿå™¨</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; padding-top: 50px; }
        .form-container { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .section-title { border-left: 5px solid #0d6efd; padding-left: 10px; margin-bottom: 20px; color: #333; }
    </style>
</head>
<body>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-8 form-container">
            <h2 class="text-center mb-4">ğŸ“ é€šå ±å–®åŸºæœ¬è³‡æ–™è¼¸å…¥</h2>
            <hr>

            <form id="noticeForm">
                <div class="section-title"><h5>åŸºæœ¬è³‡è¨Š</h5></div>
                <div class="row g-3 mb-4">
                    <div class="col-md-6">
                        <label class="form-label">é€šå ±å–®ç·¨è™Ÿ (Notice No.)</label>
                        <input type="text" class="form-control" id="noticeNo" placeholder="ä¾‹å¦‚ï¼š112001" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">æ¸¬é‡äººå“¡</label>
                        <select class="form-select" id="surveyStaff">
                            <option value="åº­ç‘‹">åº­ç‘‹</option>
                            <option value="ç¶“ç†">ç¶“ç†</option>
                            <option value="å°å·¦">å°å·¦</option>
                            <option value="ç…œç’¿">ç…œç’¿</option>
                            <option value="é›…è±">é›…è±</option>
                            <option value="é˜¿å˜">é˜¿å˜</option>
                        </select>
                    </div>
                    <div class="col-12">
                        <label class="form-label">æ–½å·¥åœ°é» (Position)</label>
                        <input type="text" class="form-control" id="workingPosition" placeholder="è«‹è¼¸å…¥è©³ç´°åœ°å€æˆ–è·¯æ®µ" required>
                    </div>
                </div>

                <div class="section-title"><h5>æ—¥æœŸè¨­å®š</h5></div>
                <div class="row g-3 mb-4">
                    <div class="col-md-4">
                        <label class="form-label">å‹˜æŸ¥æ—¥æœŸ</label>
                        <input type="date" class="form-control" id="surveyDate">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">é å®šé–‹å·¥æ—¥</label>
                        <input type="date" class="form-control" id="startDate">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">å ±å®Œå·¥æ—¥æœŸ</label>
                        <input type="date" class="form-control" id="submitDay">
                    </div>
                </div>

                <div class="section-title"><h5>é¡å‹èˆ‡åˆç´„</h5></div>
                <div class="row g-3 mb-4">
                    <div class="col-md-6">
                        <label class="form-label">æ¡ˆä»¶é¡å‹</label>
                        <div class="mt-2">
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="caseType" id="typeEmergency" value="æ¶ä¿®æ¡ˆ" checked>
                                <label class="form-check-label" for="typeEmergency">æ¶ä¿®æ¡ˆ</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="caseType" id="typeNormal" value="ä¸€èˆ¬æ¡ˆ">
                                <label class="form-check-label" for="typeNormal">ä¸€èˆ¬æ¡ˆ</label>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">åˆç´„é¡åˆ¥</label>
                        <select class="form-select" id="contractTxt">
                            <option value="åŒ—æ¶">åŒ—æ¶</option>
                            <option value="ä¸­æ¾">ä¸­æ¾</option>
                            <option value="å£«å¤§">å£«å¤§</option>
                            <option value="åŒ—æŠ•">åŒ—æŠ•</option>
                            <option value="å…¨å¸‚æ¶">å…¨å¸‚æ¶</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">é è¨ˆå·¥æœŸ (æ—¥æ›†å¤©)</label>
                        <input type="number" class="form-control" id="expectDate" value="7">
                    </div>
                </div>

                <div class="d-grid gap-2">
                    <button type="button" class="btn btn-primary btn-lg" onclick="submitData()">ç”¢ç”Ÿ JSON æª”æ¡ˆ</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    async function submitData() {
      const payload = {
          surveyDate: document.getElementById('surveyDate').value,
          startDate: document.getElementById('startDate').value,
          expectDate: document.getElementById('expectDate').value,
          submitDay: document.getElementById('submitDay').value,
          caseType: document.querySelector('input[name="caseType"]:checked').value,
          workingPosition: document.getElementById('workingPosition').value,
          noticeNo: document.getElementById('noticeNo').value,
          surveyStaff: document.getElementById('surveyStaff').value,
          contractTxt: document.getElementById('contractTxt').value
      };

      // ç™¼é€åˆ° Flask API
      const response = await fetch('/api/save_json', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
      });

      const result = await response.json();

      if (result.status === "success") {
          // åœ¨å®¢æˆ¶ç«¯è§¸ç™¼ä¸‹è¼‰
          const blob = new Blob([result.json_str], { type: "application/json" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `Json_Output_${payload.noticeNo}.json`;
          a.click();
          alert("JSON è³‡æ–™è™•ç†å®Œæˆä¸¦å·²ä¸‹è¼‰ï¼");
      }
  }
</script>

</body>
</html>